<!DOCTYPE html>
<html>
    <body>
        <h1>Final step for Login with Amazon</h1>
        <p>Enjoy the ride.</p>
        <p>I'm hosted with GitHub Pages.</p>
        <script type="text/javascript">
            //compose url
            // first get the state
            var code = getParameterByName("code", window.location.href);	
            console.log("Code: " + code);
            var body = "grant_type=authorization_code" +
            "?code=" + code + 
            "?client_id=amzn1.application-oa2-client.b7a978f5efc248a098d2c0588dfb8392" +
            "?client_secret=5b8009ce5a4b746d17f57965ce328a55c0847cfd75827101dff671b38fd8f9a9" +
            "?redirect_uri=https%3A%2F%2Flogoshealth.github.io/complete.html";  
            //"?redirect_uri=https://logoshealth.github.io/complete.html";  

            var redir = "https://api.amazon.com/auth/o2/token";
            var myHeaders = new Headers();
            myHeaders.append('Content-Type', 'application/x-www-form-urlencoded');
            myHeaders.append('Cache-Control', 'no-cache');
            
            //redirect to URL
            console.log("body: " + body);
            document.body.innerHTML = body;
            let form = document.createElement('form');
            form.action = redir;
            form.method = 'POST';
            //form.innerHTML = '<input name="q" value="test">';
            // the form must be in the document to submit it
            document.body.append(form);
            //form.submit();            
            //window.location.href = redir;
            
                function getParameterByName(name, url) {
                //SHAMELESSLY BORROWED FROM STACK OVERFLOW
                //SHAMELESSLY BORROWED FROM The YittishNinja

                    if (!url) url = window.location.href;
                    name = name.replace(/[\[\]]/g, "\\$&");
                    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
                    results = regex.exec(url);
                    if (!results) return null;
                    if (!results[2]) return '';
                    return decodeURIComponent(results[2].replace(/\+/g, " "));
                }	
        </script>
    </body>
</html>
